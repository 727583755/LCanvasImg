/**
 * LCanvasImg图像文字合成插件
 * 
 * version:1.0.0
 * 
 * author:黄磊
 * 
 * git:https://github.com/xfhxbb/LCanvasImg
 * 
 * 报告漏洞，意见或建议, 请联系邮箱：xfhxbb@yeah.net
 * 
 * Copyright 2016
 * 
 * Licensed under MIT
 * 
 * 获得使用本类库的许可, 您必须保留著作权声明信息
 * 
 * 最近修改于： 2017-2-14 14:59:54
 */
!function(){window.LCanvasImg=function(t){var a=this;a.params={cw:window.innerWidth,ch:window.innerHeight,iw:"100%",ih:"auto",display:"none"};for(var e in t)a.params[e]=t[e];a.init()},LCanvasImg.prototype={init:function(){var t=document.querySelector("#LCanvasImg_canvas");if(t)t.width=this.params.cw,t.height=this.params.ch,t.style.display=this.params.display,this.canvas=t;else{var a=document.createElement("canvas");a.id="LCanvasImg_canvas",a.width=this.params.cw,a.height=this.params.ch,a.style.display=this.params.display,document.body.appendChild(a),this.canvas=a}this.clear()},clear:function(){var t=this,a=t.canvas,e=a.getContext("2d");e.clearRect(0,0,a.width,a.height)},load:function(t,a){var e=this,n=document.querySelector("body");n.addEventListener("complete",function(){a(),console.log("complete")});var s=1;t.forEach(function(t,a,i){function r(){if(e[t.name]=h,s<i.length)++s;else{var a;try{a=new CustomEvent("complete")}catch(r){a=document.createEvent("Event"),a.initEvent("complete",!0,!0)}n.dispatchEvent(a)}}var h=new Image;h.onload=r,h.onerror=r,h.src=t.src})},addFont:function(t){var a=this,e=a.canvas,n=e.getContext("2d");n.font=t.fontsize+"px "+t.fontfamily;var s=t.ftop,i=t.fleft;n.textBaseline="top",n.fillText(t.txt,i,s),n.lineWidth=1,n.fillStyle="#000",n.strokeStyle="rgba(255,255,255,0.4)",n.strokeText(t.txt,i,s)},addImg:function(t,a){var e=this,n=e.canvas,s=n.getContext("2d");t.hasOwnProperty("sx")&&t.hasOwnProperty("sy")&&t.hasOwnProperty("sw")&&t.hasOwnProperty("sh")&&t.hasOwnProperty("x")&&t.hasOwnProperty("y")&&t.hasOwnProperty("width")&&t.hasOwnProperty("height")?s.drawImage(e[t.name],t.sx,t.sy,t.sw,t.sh,t.x,t.y,t.width,t.height):t.hasOwnProperty("x")&&t.hasOwnProperty("y")&&t.hasOwnProperty("width")&&t.hasOwnProperty("height")?s.drawImage(e[t.name],t.x,t.y,t.width,t.height):t.hasOwnProperty("x")&&t.hasOwnProperty("y")?s.drawImage(e[t.name],t.x,t.y):s.drawImage(e[t.name],0,0),e.showImg()},showImg:function(){var t=this,a=t.canvas,e=document.querySelector("#LCanvasImg_img");if(e)e.style.width=t.params.iw,e.style.height=t.params.ih,e.src=a.toDataURL();else{var n=new Image;n.id="LCanvasImg_img",n.style.width=t.params.iw,n.style.height=t.params.ih,n.src=a.toDataURL(),document.body.appendChild(n)}}}}();